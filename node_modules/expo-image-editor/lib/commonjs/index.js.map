{"version":3,"sources":["index.tsx"],"names":["noScroll","require","EditorContext","React","createContext","throttleBlur","minimumCropDimensions","width","height","fixedAspectRatio","lockAspectRatio","mode","onCloseEditor","onEditingComplete","ImageEditorCore","props","fixedCropAspectRatio","allowedTransformOperations","allowedAdjustmentOperations","setImageData","imageDataState","setReady","readyState","setEditingMode","editingModeState","useEffect","initialise","imageUri","enableEditor","on","Platform","OS","img","document","createElement","onload","uri","src","pickerWidth","pickerHeight","ImageManipulator","manipulateAsync","off","visible","asView","ImageEditorView","ready","processing","setProcessing","processingState","styles","container","ImageEditor","StyleSheet","create","flex","backgroundColor"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { StyleSheet, View, StatusBar, Platform } from \"react-native\";\nimport { ControlBar } from \"./ControlBar\";\nimport { EditingWindow } from \"./EditingWindow\";\nimport * as ImageManipulator from \"expo-image-manipulator\";\nimport { Processing } from \"./Processing\";\nimport { useRecoilState, RecoilRoot } from \"recoil\";\nimport {\n  processingState,\n  imageDataState,\n  editingModeState,\n  readyState,\n  ImageDimensions,\n} from \"./Store\";\nimport { OperationBar } from \"./OperationBar/OperationBar\";\nimport { UniversalModal } from \"./UniversalModal\";\nconst noScroll = require(\"no-scroll\");\n\ntype EditorContextType = {\n  throttleBlur: boolean;\n  minimumCropDimensions: ImageDimensions;\n  fixedAspectRatio: number;\n  lockAspectRatio: boolean;\n  mode: Mode;\n  onCloseEditor: () => void;\n  onEditingComplete: (result: any) => void;\n  allowedTransformOperations?: TransformOperations[];\n  allowedAdjustmentOperations?: AdjustmentOperations[];\n};\n\nexport const EditorContext = React.createContext<EditorContextType>({\n  throttleBlur: true,\n  minimumCropDimensions: {\n    width: 0,\n    height: 0,\n  },\n  fixedAspectRatio: 1.6,\n  lockAspectRatio: false,\n  mode: \"full\",\n  onCloseEditor: () => {},\n  onEditingComplete: () => {},\n});\n\nexport type Mode = \"full\" | \"crop-only\";\n\nexport type TransformOperations = \"crop\" | \"rotate\";\nexport type AdjustmentOperations = \"blur\";\nexport type EditingOperations = TransformOperations | AdjustmentOperations;\n\nexport interface ImageEditorProps {\n  visible: boolean;\n  onCloseEditor: () => void;\n  imageUri: string | undefined;\n  fixedCropAspectRatio?: number;\n  minimumCropDimensions?: {\n    width: number;\n    height: number;\n  };\n  onEditingComplete: (result: any) => void;\n  lockAspectRatio?: boolean;\n  throttleBlur?: boolean;\n  mode?: Mode;\n  allowedTransformOperations?: TransformOperations[];\n  allowedAdjustmentOperations?: AdjustmentOperations[];\n  asView?: boolean;\n}\n\nfunction ImageEditorCore(props: ImageEditorProps) {\n  //\n  const {\n    mode = \"full\",\n    throttleBlur = true,\n    minimumCropDimensions = { width: 0, height: 0 },\n    fixedCropAspectRatio: fixedAspectRatio = 1.6,\n    lockAspectRatio = false,\n    allowedTransformOperations,\n    allowedAdjustmentOperations,\n  } = props;\n\n  const [, setImageData] = useRecoilState(imageDataState);\n  const [, setReady] = useRecoilState(readyState);\n  const [, setEditingMode] = useRecoilState(editingModeState);\n\n  // Initialise the image data when it is set through the props\n  React.useEffect(() => {\n    const initialise = async () => {\n      if (props.imageUri) {\n        const enableEditor = () => {\n          setReady(true);\n          // Set no-scroll to on\n          noScroll.on();\n        };\n        // Platform check\n        if (Platform.OS === \"web\") {\n          let img = document.createElement(\"img\");\n          img.onload = () => {\n            setImageData({\n              uri: props.imageUri ?? \"\",\n              height: img.height,\n              width: img.width,\n            });\n            enableEditor();\n          };\n          img.src = props.imageUri;\n        } else {\n          const { width: pickerWidth, height: pickerHeight } =\n            await ImageManipulator.manipulateAsync(props.imageUri, []);\n          setImageData({\n            uri: props.imageUri,\n            width: pickerWidth,\n            height: pickerHeight,\n          });\n          enableEditor();\n        }\n      }\n    };\n    initialise();\n  }, [props.imageUri]);\n\n  const onCloseEditor = () => {\n    // Set no-scroll to off\n    noScroll.off();\n    props.onCloseEditor();\n  };\n\n  React.useEffect(() => {\n    // Reset the state of things and only render the UI\n    // when this state has been initialised\n    if (!props.visible) {\n      setReady(false);\n    }\n    // Check if ther mode is set to crop only if this is the case then set the editingMode\n    // to crop\n    if (mode === \"crop-only\") {\n      setEditingMode(\"crop\");\n    }\n  }, [props.visible]);\n\n  return (\n    <EditorContext.Provider\n      value={{\n        mode,\n        minimumCropDimensions,\n        lockAspectRatio,\n        fixedAspectRatio,\n        throttleBlur,\n        allowedTransformOperations,\n        allowedAdjustmentOperations,\n        onCloseEditor,\n        onEditingComplete: props.onEditingComplete,\n      }}\n    >\n      <StatusBar hidden={props.visible} />\n      {props.asView ? (\n        <ImageEditorView {...props} />\n      ) : (\n        <UniversalModal\n          visible={props.visible}\n          presentationStyle=\"fullScreen\"\n          statusBarTranslucent\n        >\n          <ImageEditorView {...props} />\n        </UniversalModal>\n      )}\n    </EditorContext.Provider>\n  );\n}\n\nexport function ImageEditorView(props: ImageEditorProps) {\n  //\n  const { mode = \"full\" } = props;\n\n  const [ready, setReady] = useRecoilState(readyState);\n  const [processing, setProcessing] = useRecoilState(processingState);\n\n  return (\n    <>\n      {ready ? (\n        <View style={styles.container}>\n          <ControlBar />\n          <EditingWindow />\n          {mode === \"full\" && <OperationBar />}\n        </View>\n      ) : null}\n      {processing ? <Processing /> : null}\n    </>\n  );\n}\n\nexport function ImageEditor(props: ImageEditorProps) {\n  //\n\n  return (\n    <RecoilRoot>\n      <ImageEditorCore {...props} />\n    </RecoilRoot>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: \"#222\",\n  },\n});\n"]}